!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Simpla",t):e.Simpla=t()}(this,function(){"use strict";function e(){throw new Error("setTimeout has not been defined")}function t(){throw new Error("clearTimeout has not been defined")}function n(t){if(Qe===setTimeout)return setTimeout(t,0);if((Qe===e||!Qe)&&setTimeout)return Qe=setTimeout,setTimeout(t,0);try{return Qe(t,0)}catch(n){try{return Qe.call(null,t,0)}catch(n){return Qe.call(this,t,0)}}}function r(e){if(Ve===clearTimeout)return clearTimeout(e);if((Ve===t||!Ve)&&clearTimeout)return Ve=clearTimeout,clearTimeout(e);try{return Ve(e)}catch(n){try{return Ve.call(null,e)}catch(n){return Ve.call(this,e)}}}function o(){tt&&Ze&&(tt=!1,Ze.length?et=Ze.concat(et):nt=-1,et.length&&i())}function i(){if(!tt){var e=n(o);tt=!0;for(var t=et.length;t;){for(Ze=et,et=[];++nt<t;)Ze&&Ze[nt].run();nt=-1,t=et.length}Ze=null,tt=!1,r(e)}}function u(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];et.push(new c(e,t)),1!==et.length||tt||n(i)}function c(e,t){this.fun=e,this.array=t}function a(){}function s(e){throw new Error("process.binding is not supported")}function f(){return"/"}function l(e){throw new Error("process.chdir is not supported")}function d(){return 0}function p(e){var t=.001*_t.call(wt),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],r-=e[1],r<0&&(n--,r+=1e9)),[n,r]}function v(){var e=new Date,t=e-jt;return t/1e3}function h(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function y(e,t){return t={exports:{}},e(t,t.exports),t.exports}function m(e){var t=Dt.call(e,Ft),n=e[Ft];try{e[Ft]=void 0;var r=!0}catch(o){}var i=Lt.call(e);return r&&(t?e[Ft]=n:delete e[Ft]),i}function g(e){return Ht.call(e)}function b(e){return null==e?void 0===e?zt:Xt:Jt&&Jt in Object(e)?m(e):g(e)}function w(e,t){return function(n){return e(t(n))}}function _(e){return null!=e&&"object"==("undefined"==typeof e?"undefined":Tt(e))}function j(e){if(!_(e)||b(e)!=Gt)return!1;var t=Yt(e);if(null===t)return!0;var n=Qt.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&$t.call(n)==Vt}function O(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}function S(e,t,n){function r(){p===d&&(p=d.slice())}function o(){return l}function i(e){if("function"!=typeof e)throw new Error("Expected listener to be a function.");var t=!0;return r(),p.push(e),function(){if(t){t=!1,r();var n=p.indexOf(e);p.splice(n,1)}}}function u(e){if(!j(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if("undefined"==typeof e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(v)throw new Error("Reducers may not dispatch actions.");try{v=!0,l=f(l,e)}finally{v=!1}for(var t=d=p,n=0;n<t.length;n++)t[n]();return e}function c(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");f=e,u({type:en.INIT})}function a(){var e,t=i;return e={subscribe:function(e){function n(){e.next&&e.next(o())}if("object"!==("undefined"==typeof e?"undefined":Tt(e)))throw new TypeError("Expected the observer to be an object.");n();var r=t(n);return{unsubscribe:r}}},e[Zt]=function(){return this},e}var s;if("function"==typeof t&&"undefined"==typeof n&&(n=t,t=void 0),"undefined"!=typeof n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(S)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var f=e,l=t,d=[],p=d,v=!1;return u({type:en.INIT}),s={dispatch:u,subscribe:i,getState:o,replaceReducer:c},s[Zt]=a,s}function T(e,t){var n=t&&t.type,r=n&&'"'+n.toString()+'"'||"an action";return"Given action "+r+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state.'}function E(e){Object.keys(e).forEach(function(t){var n=e[t],r=n(void 0,{type:en.INIT});if("undefined"==typeof r)throw new Error('Reducer "'+t+'" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined.');var o="@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".");if("undefined"==typeof n(void 0,{type:o}))throw new Error('Reducer "'+t+'" returned undefined when probed with a random type. '+("Don't try to handle "+en.INIT+' or other actions in "redux/*" ')+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined.")})}function A(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var o=t[r];"function"==typeof e[o]&&(n[o]=e[o])}var i,u=Object.keys(n);try{E(n)}catch(c){i=c}return function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1];if(i)throw i;for(var r=!1,o={},c=0;c<u.length;c++){var a=u[c],s=n[a],f=e[a],l=s(f,t);if("undefined"==typeof l){var d=T(a,t);throw new Error(d)}o[a]=l,r=r||l!==f}return r?o:e}}function k(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)return function(e){return e};if(1===t.length)return t[0];var r=t[t.length-1],o=t.slice(0,-1);return function(){return o.reduceRight(function(e,t){return t(e)},r.apply(void 0,arguments))}}function P(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(n,r,o){var i=e(n,r,o),u=i.dispatch,c=[],a={getState:i.getState,dispatch:function(e){return u(e)}};return c=t.map(function(e){return e(a)}),u=k.apply(void 0,c)(i.dispatch),tn({},i,{dispatch:u})}}}function x(e,t){return{type:nn,prop:e,value:t}}function q(){return{type:Nn}}function I(){return{type:Cn}}function N(e){var t=void 0;return e.ok?e:(t=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.code||e.status,r=t.statusText||e.statusText,o=new Error(r);return o.code=n,o.statusText=r,Promise.reject(o)},Promise.resolve().then(function(){return e.json()}).then(function(e){return t(e)},function(){return t({code:e.status,statusText:e.statusText})}))}function C(e){var t=Pt({},e);return t.headers=Pt({Accept:"application/json"},t.headers),e.body&&(t.body=JSON.stringify(e.body),t.headers=Pt({"Content-Type":"application/json"},t.headers)),Un(e.url,t).then(N).then(function(e){return 204===e.status?null:e.json()})}function R(e){var t=e.token;return t&&(e.headers=Pt({Authorization:"Bearer "+t},e.headers)),C(e)}function M(e){var t=e.email,n=e.password;return{type:rn,email:t,password:n}}function U(e){return{type:on,response:e}}function D(e){return{type:un,response:e}}function L(e){var t=e.email,n=e.password;return function(e,r){var o=r().config.authEndpoint;return e(M({email:t,password:n})),Dn.post(o+"/login",{body:{email:t,password:n}}).then(function(t){return e(U(t.token))},function(t){return e(D(t))})}}function F(){return{type:cn}}function B(){return{type:an}}function H(){return function(e){return e(F()),Promise.resolve().then(function(){return e(B())})}}function X(e,t){var n=void 0,r=void 0;return"undefined"==typeof t?t:"string"==typeof e?X(e.split("."),t):(n=e[0],r=parseInt(n),isNaN(r)||(n=r),0===e.length?t:X(e.slice(1),t[n]))}function z(e,t){var n=t[Fn],r=void 0;return n&&(r=n.content[e]),r}function J(e,t){var n=t[Fn].content;return{items:e.map(function(e){return n[e]})}}function Y(e,t){var n=t[Fn],r=[],o=void 0;return n?(o=n.content||{},r=Object.keys(e).map(function(t){return Xn[t](e[t])}).reduce(function(e,t){return e.filter(function(e){return t(o[e])})},Object.keys(n.content)),J(r,t)):{items:[]}}function G(e){return{observe:function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n.pop(),i=n[0],u=void 0,c=void 0,a=void 0;return c=function(){return i?X(i,e.getState()):e.getState()},u=c(),a=function(){var e=c();if(e!==u){var t=[e,u];u=e,o.apply(void 0,t)}},{unobserve:e.subscribe(a)}}}}function K(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];return"undefined"!=typeof t&&null!==t&&Object.keys(e).map(function(t){return Xn[t](e[t])}).every(function(e){return e(t)})}function W(e){return function(t){return t.type===e?Promise.resolve(t):Promise.reject(t)}}function $(e,t,n){var r=function(e){return"undefined"!=typeof e.type&&"undefined"!=typeof e.response};return e(t).then(W(n)).then(function(e){return e.response},function(e){return r(e)?Promise.reject(e.response):Promise.reject(e)})}function Q(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return $.apply(void 0,[e.dispatch].concat(n))}function V(e){var t;if("object"!==("undefined"==typeof e?"undefined":Tt(e))||!e)return e;if("[object Array]"===Object.prototype.toString.apply(e))return e.map(V);t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=V(e[n]));return t}function Z(e){var t=["type","data"],n=Object.keys(e||{});return 0!==n.length&&n.every(function(e){return t.indexOf(e)!==-1})}function ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=function(e,t){return e<t?-1:e>t?1:0};return Object.keys(e).sort(t).reduce(function(t,n){var r=e[n],o=void 0;return o=t?t+"&":"?",""+o+n+"="+encodeURIComponent(r)},"")}function te(e,t){var n=t[Bn],r=ee(e);return!!(n&&n[r]&&n[r].queriedRemote)}function ne(){return{type:null,data:null}}function re(e,t){return null===t?null:Pt(V(t),{id:e})}function oe(e){return e?(e=e.replace(/^\/+/,"").replace(/\/+$/,""),e.split("/").join(".")):e}function ie(e){return e?("."!==e.charAt(0)&&(e="."+e),e.split(".").join("/")):e}function ue(e){var t=void 0,n=void 0;return e?(t=ie(e.id),n=Pt({},e,{path:t}),delete n.id,n):e}function ce(e){var t=void 0;return e?(t=e.items.map(ue),Pt({},e,{items:t})):e}function ae(e){if("/"!==e.charAt(0))throw new Error("Invalid path "+e+". Path must be a string starting with '/'");if(e.indexOf("//")!==-1)throw new Error("Invalid path '"+e+"'. Paths must not have more than one '/' in a row.")}function se(e,t){var n=window.toString.call(e),r=function(e){return function(t,n){return se(t,e[n])}},o=function(e,t){return function(n){return n in e&&n in t&&se(e[n],t[n])}},i=void 0;if(n!==toString.call(t))return!1;switch(n){case"[object String]":case"[object Number]":case"[object Boolean]":case"[object Null]":case"[object Undefined]":return e===t}return Array.isArray(e)?e.length===t.length&&e.every(r(t)):(i=Object.keys(e),i.length===Object.keys(t).length&&i.every(o(e,t)))}function fe(e){if("undefined"!=typeof e&&""===e)return"Invalid UID: Empty string is not a valid UID"}function le(e){var t=e.uid,n=void 0===t?"":t,r=e.validateUid,o=void 0===r||r,i=e.query,u=e.endpoint,c=e.token,a=e.method,s=e.body,f=u+"/"+encodeURIComponent(n)+ee(i),l=fe(n);return o&&l?Promise.reject(new Error(l)):Dn[a](f,{body:s,token:c})}function de(e,t,n,r){var o=xt(n,3),i=o[0],u=o[1],c=o[2];return function(){for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return function(n,a){var s=a(),f=s.config,l=s.token,d=f.dataEndpoint,p=void 0;return p=Pt({method:e,endpoint:d,token:l,validateUid:r},t.apply(void 0,o)),n(i.apply(void 0,o)),le(p).then(function(e){return n(u.apply(void 0,o.concat([e])))},function(e){return n(c.apply(void 0,o.concat([e])))})}}}function pe(e){return{type:dn,query:e}}function ve(e,t){return{type:pn,query:e,response:t}}function he(e){return{type:vn,uid:e}}function ye(e,t){return{type:hn,response:t,uid:e}}function me(e,t){return{type:yn,uid:e,data:t}}function ge(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=Pt({persist:!0},n);var r=n,o=r.persist;return{type:mn,response:re(e,t),uid:e,persist:o}}function be(e,t){return{type:gn,response:t,uid:e}}function we(e){return{type:bn,uid:e}}function _e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Pt({persist:!0},t);var n=t,r=n.persist;return{type:wn,uid:e,persist:r}}function je(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=Pt({validate:!0,createAncestry:!0,persist:!0},n);var r=n,o=r.validate,i=r.createAncestry,u=r.persist;return function(n,r){function c(e){var t=e.split(".").slice(0,-1).join(".");return!t||z(t,r())?Promise.resolve():$(n,je(t,ne(t),{persist:!1}),mn)}var a=void 0;if(n(me(e,t)),o&&!Z(t))a=be(e,new Error(Ln));else{var s=z(e,r());"undefined"!=typeof s&&(t=Pt({},s,t)),a=ge(e,t,{persist:u})}return(i?c(e):Promise.resolve()).then(function(){return n(a)})}}function Oe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Pt({persist:!0},t);var n=t,r=n.persist;return function(t,n){function o(e){if(!e)return Promise.resolve();var r=Y({parent:e},n()),o=r.items,i=function(e){return $(t,Oe(e.id,{persist:!1}),wn)};return Promise.all(o.map(i))}return t(we(e)),o(e).then(function(){return t(_e(e,{persist:r}))})}}function Se(e){return function(t,n){var r=void 0,o=void 0,i=void 0;return t(he(e)),r=n(),o=z(e,r),i="undefined"==typeof o?$(t,nr(e),Tn).then(function(n){return $(t,je(e,n,{validate:!1,createAncestry:!1}),mn)}):Promise.resolve(o),i.then(function(n){return t(ye(e,n))})}}function Te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n){var r=void 0,o=void 0,i=void 0;return t(pe(e)),o=function(e){return $(t,je(e.id,e,{validate:!1}),mn)},r=function(e){var t=n(),r=function(e){var n=e.id;return"undefined"==typeof z(n,t)};return Promise.all(e.items.filter(r).map(o))},i=function(){return Promise.resolve().then(function(){return Y(e,n())}).then(function(n){return t(ve(e,n))})},te(e,n())?i():$(t,ir(e),jn).then(r).then(i)}}function Ee(e){var t=e.query,n=e.content;return{type:Rn,query:t,content:n}}function Ae(){return{type:sn}}function ke(){return{type:fn}}function Pe(){return{type:ln}}function xe(){return function(e,t){var n=void 0,r=void 0,o=void 0,i=void 0,u=void 0;e(Ae());var c=t().buffer.verbose,a=Object.keys(c).map(function(e){return[e,c[e]]});return r=function(e){var t=xt(e,2),n=t[1],r=n.local,o=n.changed;return null===r&&o},o=function(e){var t=xt(e,2),n=t[1],r=n.local,o=n.changed;return null!==r&&o},n=function(t){return $(e,je(t.id,t,{validate:!1}),mn)},i=a.filter(o).map(function(e){var t=xt(e,2),n=t[0],r=t[1].local;return rr(n,r)}).map(function(t){return $(e,t,kn).then(n)}),u=a.filter(r).map(function(e){var t=xt(e,1),n=t[0];return or(n)}).map(function(t){return $(e,t,qn)}),Promise.all([].concat(qt(i),qt(u))).then(function(){return e(ke())},function(){return e(Pe())})}}function qe(){window.Polymer=window.Polymer||{dom:"shadow"}}function Ie(e){var t=(new Date).getTime()/1e3,n=void 0;if(!e)return!1;try{var r=e.split("."),o=xt(r,2),i=o[1];n=JSON.parse(atob(i))}catch(u){return console.warn(pr,u.message),!1}return!(n.exp&&t>n.exp)&&!(!n.iss||n.iss!==sr)}function Ne(e){if(e)try{window.localStorage.setItem(ar,e)}catch(t){console.warn(fr)}else try{window.localStorage.removeItem(ar)}catch(t){console.warn(dr)}}function Ce(e){var t=void 0;try{t=window.localStorage.getItem(ar)}catch(n){t=!1,console.log(lr)}if(Ie(t))e._store.dispatch(U(t));else try{window.localStorage.removeItem(ar)}catch(n){console.warn(dr)}}function Re(e){return function(t){var n=t.dispatch,r=t.getState;return function(t){return function(o){return"function"==typeof o?o(n,r,e):t(o)}}}}function Me(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments[1];switch(t.type){case on:return!0;case an:return!1;default:return e}}function Ue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];switch(t.type){case nn:return Pt({},e,kt({},t.prop,t.value));default:return e}}function De(e,t,n){return Pt({},e,kt({},t,Pt({},e[t],n)))}function Le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=void 0;switch(t.type){case dn:return n=ee(t.query),e[n]?e[n].querying?e:De(e,n,{querying:!0}):De(e,n,{query:t.query,querying:!0,queriedRemote:!1,cache:[],matches:[]});case pn:if(n=ee(t.query),0!==e[n].cache.length){var r=e[n],o=r.matches,i=r.cache,u=void 0;if(u=[].concat(qt(o),qt(i.filter(mr(o)))),u.length!==o.length)return De(e,n,{querying:!1,cache:[],matches:u})}return De(e,n,{cache:[],querying:!1});case jn:return n=ee(t.query),e[n].queriedRemote?e:De(e,n,{queriedRemote:!0});case Rn:var c=t.content,a=t.query;if(n=ee(a),!e[n]){var s=Object.keys(c).filter(function(e){return K(a,c[e])});return De(e,n,{query:a,querying:!1,queriedRemote:!1,cache:[],matches:s})}return e;case mn:return Object.keys(e).reduce(function(e,n){var r=e[n],o=r.query,i=r.matches,u=r.cache,c=r.querying,a=t.response,s=t.uid,f=c?u:i,l=void 0;if(K(o,a)){if(f.indexOf(s)!==-1)return e;l=[].concat(qt(f),[s])}else l=f.filter(gr(s));return l.length!==f.length?De(e,n,kt({},c?"cache":"matches",l)):e},e);case wn:return Object.keys(e).reduce(function(e,n){var r=e[n].matches,o=t.uid,i=void 0;return i=r.filter(gr(o)),i!==r.length?De(e,n,{matches:i}):e},e);default:return e}}function Fe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:br,t=arguments[1];switch(t.type){case Nn:return!0;case Cn:return!1;default:return e}}function Be(e,t){var n=t[0],r=1===t.length?{}:Be(e[n]||{},t.slice(1));return Pt({},e,kt({},n,r))}function He(e,t){var n=t[0];if(1===t.length){var r=Pt({},e);return delete r[n],r}return e.hasOwnProperty(n)?Pt({},e,kt({},n,He(e[n],t.slice(1)))):e}function Xe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];switch(t.type){case mn:return Be(e,t.uid.split("."),{});case wn:return He(e,t.uid.split("."));default:return e}}function ze(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];switch(t.type){case mn:var n=e[t.uid],r=V(t.response);return se(n,r)?e:Pt({},e,kt({},t.uid,V(t.response)));case wn:return null===e[t.uid]?e:Pt({},e,kt({},t.uid,null));default:return e}}function Je(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments[1];switch(t.type){case on:return t.response;case cn:return null;default:return e}}function Ye(e){return Object.keys(e).reduce(function(t,n){var r=e[n].changed;return Pt(t,kt({},ie(n),{modified:r}))},{})}function Ge(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],r=e.local,o=e.remote,i=e.changed;return n?o=V(t||null):r=V(t||null),i=!se(o,r),Pt({},e,{local:r,remote:o,changed:i})}function Ke(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=void 0,r=void 0,o=void 0;switch(n=function(t){return function(n,r,o){var i=n[r],u=Ge(n[r],o,t);return i===u?e:Pt({},n,kt({},r,u))}},r=n(!1),o=n(!0),t.type){case jn:return t.response.items.reduce(function(e,t){return o(e,t.id,t)},e);case Tn:case kn:return o(e,t.uid,t.response);case qn:return o(e,t.uid,null);case mn:return t.persist?r(e,t.uid,t.response):e;case wn:if(!t.persist){var i=Pt({},e);return delete i[t.uid],i}return r(e,t.uid,t.response);default:return e}}function We(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_r,t=arguments[1],n=void 0,r=void 0;return n=Ke(e.verbose,t),n!==e.verbose?(r=Ye(n),{verbose:n,simple:r}):e}var $e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},Qe=e,Ve=t;"function"==typeof $e.setTimeout&&(Qe=setTimeout),"function"==typeof $e.clearTimeout&&(Ve=clearTimeout);var Ze,et=[],tt=!1,nt=-1;c.prototype.run=function(){this.fun.apply(null,this.array)};var rt,ot="browser",it="browser",ut=!0,ct={},at=[],st="",ft={},lt={},dt={},pt=a,vt=a,ht=a,yt=a,mt=a,gt=a,bt=a,wt=$e.performance||{},_t=wt.now||wt.mozNow||wt.msNow||wt.oNow||wt.webkitNow||function(){return(new Date).getTime()},jt=new Date,Ot={nextTick:u,title:ot,browser:ut,env:ct,argv:at,version:st,versions:ft,on:pt,addListener:vt,once:ht,off:yt,removeListener:mt,removeAllListeners:gt,emit:bt,binding:s,cwd:f,chdir:l,umask:d,hrtime:p,platform:it,release:lt,config:dt,uptime:v},St="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Et=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},At=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),kt=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},Pt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},xt=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,c=e[Symbol.iterator]();!(r=(u=c.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(a){o=!0,i=a}finally{try{!r&&c["return"]&&c["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),qt=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},It=y(function(e,t){!function(t,n){e.exports=n()}(St,function(){function e(e){return"function"==typeof e||"object"===("undefined"==typeof e?"undefined":Tt(e))&&null!==e}function t(e){return"function"==typeof e}function n(e){K=e}function r(e){W=e}function o(){return function(){return u(f)}}function i(){return"undefined"!=typeof G?function(){G(f)}:s()}function c(){var e=0,t=new V(f),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function a(){var e=new MessageChannel;return e.port1.onmessage=f,function(){return e.port2.postMessage(0)}}function s(){var e=setTimeout;return function(){return e(f,1)}}function f(){for(var e=0;e<Y;e+=2){var t=te[e],n=te[e+1];t(n),te[e]=void 0,te[e+1]=void 0}Y=0}function l(){try{var e=h,t=e("vertx");return G=t.runOnLoop||t.runOnContext,i()}catch(n){return s()}}function d(e,t){var n=arguments,r=this,o=new this.constructor(v);void 0===o[re]&&C(o);var i=r._state;return i?!function(){var e=n[i-1];W(function(){return q(i,o,e,r._result)})}():A(r,o,e,t),o}function p(e){var t=this;if(e&&"object"===("undefined"==typeof e?"undefined":Tt(e))&&e.constructor===t)return e;var n=new t(v);return O(n,e),n}function v(){}function y(){return new TypeError("You cannot resolve a promise with itself")}function m(){return new TypeError("A promises callback cannot return that same promise.")}function g(e){try{return e.then}catch(t){return ce.error=t,ce}}function b(e,t,n,r){try{e.call(t,n,r)}catch(o){return o}}function w(e,t,n){W(function(e){var r=!1,o=b(n,t,function(n){r||(r=!0,t!==n?O(e,n):T(e,n))},function(t){r||(r=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,E(e,o))},e)}function _(e,t){t._state===ie?T(e,t._result):t._state===ue?E(e,t._result):A(t,void 0,function(t){return O(e,t)},function(t){return E(e,t)})}function j(e,n,r){n.constructor===e.constructor&&r===d&&n.constructor.resolve===p?_(e,n):r===ce?(E(e,ce.error),ce.error=null):void 0===r?T(e,n):t(r)?w(e,n,r):T(e,n)}function O(t,n){t===n?E(t,y()):e(n)?j(t,n,g(n)):T(t,n)}function S(e){e._onerror&&e._onerror(e._result),k(e)}function T(e,t){e._state===oe&&(e._result=t,e._state=ie,0!==e._subscribers.length&&W(k,e))}function E(e,t){e._state===oe&&(e._state=ue,e._result=t,W(S,e))}function A(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+ie]=n,o[i+ue]=r,0===i&&e._state&&W(k,e)}function k(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,u=0;u<t.length;u+=3)r=t[u],o=t[u+n],r?q(n,r,o,i):o(i);e._subscribers.length=0}}function P(){this.error=null}function x(e,t){try{return e(t)}catch(n){return ae.error=n,ae}}function q(e,n,r,o){var i=t(r),u=void 0,c=void 0,a=void 0,s=void 0;if(i){if(u=x(r,o),u===ae?(s=!0,c=u.error,u.error=null):a=!0,n===u)return void E(n,m())}else u=o,a=!0;n._state!==oe||(i&&a?O(n,u):s?E(n,c):e===ie?T(n,u):e===ue&&E(n,u))}function I(e,t){try{t(function(t){O(e,t)},function(t){E(e,t)})}catch(n){E(e,n)}}function N(){return se++}function C(e){e[re]=se++,e._state=void 0,e._result=void 0,e._subscribers=[]}function R(e,t){this._instanceConstructor=e,this.promise=new e(v),this.promise[re]||C(this.promise),J(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?T(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&T(this.promise,this._result))):E(this.promise,M())}function M(){return new Error("Array Methods must be provided an Array")}function U(e){return new R(this,e).promise}function D(e){var t=this;return new t(J(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function L(e){var t=this,n=new t(v);return E(n,e),n}function F(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function B(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function H(e){this[re]=N(),this._result=this._state=void 0,this._subscribers=[],v!==e&&("function"!=typeof e&&F(),this instanceof H?I(this,e):B())}function X(){var e=void 0;if("undefined"!=typeof St)e=St;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var r=null;try{r=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===r&&!n.cast)return}e.Promise=H}var z=void 0;z=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var J=z,Y=0,G=void 0,K=void 0,W=function(e,t){te[Y]=e,te[Y+1]=t,Y+=2,2===Y&&(K?K(f):ne())},$="undefined"!=typeof window?window:void 0,Q=$||{},V=Q.MutationObserver||Q.WebKitMutationObserver,Z="undefined"==typeof self&&"undefined"!=typeof Ot&&"[object process]"==={}.toString.call(Ot),ee="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,te=new Array(1e3),ne=void 0;ne=Z?o():V?c():ee?a():void 0===$&&"function"==typeof h?l():s();var re=Math.random().toString(36).substring(16),oe=void 0,ie=1,ue=2,ce=new P,ae=new P,se=0;return R.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===oe&&n<e;n++)this._eachEntry(t[n],n)},R.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===p){var o=g(e);if(o===d&&e._state!==oe)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===H){var i=new n(v);j(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},R.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===oe&&(this._remaining--,e===ue?E(r,n):this._result[t]=n),0===this._remaining&&T(r,this._result)},R.prototype._willSettleAt=function(e,t){var n=this;A(e,void 0,function(e){return n._settledAt(ie,t,e)},function(e){return n._settledAt(ue,t,e)})},H.all=U,H.race=D,H.resolve=p,H.reject=L,H._setScheduler=n,H._setAsap=r,H._asap=W,H.prototype={constructor:H,then:d,"catch":function(e){return this.then(null,e)}},H.polyfill=X,H.Promise=H,H})}),Nt=(It.polyfill(),"object"==("undefined"==typeof $e?"undefined":Tt($e))&&$e&&$e.Object===Object&&$e),Ct="object"==("undefined"==typeof self?"undefined":Tt(self))&&self&&self.Object===Object&&self,Rt=Nt||Ct||Function("return this")(),Mt=Rt.Symbol,Ut=Object.prototype,Dt=Ut.hasOwnProperty,Lt=Ut.toString,Ft=Mt?Mt.toStringTag:void 0,Bt=Object.prototype,Ht=Bt.toString,Xt="[object Null]",zt="[object Undefined]",Jt=Mt?Mt.toStringTag:void 0,Yt=w(Object.getPrototypeOf,Object),Gt="[object Object]",Kt=Function.prototype,Wt=Object.prototype,$t=Kt.toString,Qt=Wt.hasOwnProperty,Vt=$t.call(Object);rt="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof $e?$e:"undefined"!=typeof module?module:Function("return this")();var Zt=O(rt),en={INIT:"@@redux/INIT"},tn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},nn="set-option",rn="login",on="login-successful",un="login-failed",cn="logout",an="logout-successful",sn="save",fn="save-successful",ln="save-failed",dn="find-data",pn="find-data-successful",vn="get-data",hn="get-data-successful",yn="set-data",mn="set-data-successful",gn="set-data-failed",bn="remove-data",wn="remove-data-successful",_n="find-data-from-api",jn="find-data-from-api-successful",On="find-data-from-api-failed",Sn="get-data-from-api",Tn="get-data-from-api-successful",En="get-data-from-api-failed",An="set-data-to-api",kn="set-data-to-api-successful",Pn="set-data-to-api-failed",xn="remove-data-from-api",qn="remove-data-from-api-successful",In="remove-data-from-api-failed",Nn="edit-active",Cn="edit-inactive",Rn="observe-query",Mn="function"==typeof fetch?fetch:function(e,t){return t=t||{},new Promise(function(n,r){function o(){var e,t=[],n=[],r={};return i.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,function(o,i,u){t.push(i=i.toLowerCase()),n.push([i,u]),e=r[i],r[i]=e?e+","+u:u}),{ok:1==(i.status/200|0),status:i.status,statusText:i.statusText,url:i.responseURL,clone:o,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},xml:function(){return Promise.resolve(i.responseXML)},blob:function(){return Promise.resolve(new Blob([i.response]))},headers:{keys:function(){return t},entries:function(){return n},get:function(e){return r[e.toLowerCase()]},has:function(e){return e.toLowerCase()in r}}}}var i=new XMLHttpRequest;i.open(t.method||"get",e);for(var u in t.headers)i.setRequestHeader(u,t.headers[u]);i.withCredentials="include"==t.credentials,i.onload=function(){n(o())},i.onerror=r,i.send(t.body)})},Un=function(){var e;return window.fetch?(e=window).fetch.apply(e,arguments):Mn.apply(void 0,arguments)},Dn={get:function(e,t){return C(Pt({method:"GET"},t,{url:e}))},post:function(e,t){return R(Pt({method:"POST"},t,{url:e}))},put:function(e,t){return R(Pt({method:"PUT"},t,{url:e}))},"delete":function(e,t){return R(Pt({method:"DELETE"},t,{url:e}))}},Ln="Invalid content: only type and data properties are allowed",Fn="_data",Bn="_queries",Hn={authenticated:"authenticated",config:"config",buffer:"buffer.simple",editable:"editable",token:"token"},Xn={parent:function(e){return function(t){return t&&Xn.ancestor(e)(t)&&2===t.id.replace(e,"").split(".").length}},ancestor:function(e){return function(t){return t&&0===t.id.indexOf(e)&&0===t.id.replace(e,"").indexOf(".")}},type:function(e){return function(t){return t&&t.type===e}}},zn=function(e){return{type:_n,query:e}},Jn=function(e,t){return{type:jn,query:e,response:t}},Yn=function(e,t){return{type:On,query:e,response:t}},Gn=function(e){return{type:Sn,uid:e}},Kn=function(e,t){return{type:Tn,uid:e,response:t}},Wn=function(e,t){return{type:En,uid:e,response:t}},$n=function(e,t){return{type:An,uid:e,body:t}},Qn=function(e,t,n){return{type:kn,uid:e,body:t,response:n}},Vn=function(e,t,n){return{type:Pn,uid:e,body:t,response:n}},Zn=function(e){return{type:xn,uid:e}},er=function(e,t){return{type:qn,uid:e,response:t}},tr=function(e,t){return{type:In,uid:e,response:t}},nr=de("get",function(e){return{uid:e}},[Gn,Kn,Wn]),rr=de("put",function(e,t){return{uid:e,body:t}},[$n,Qn,Vn]),or=de("delete",function(e){return{
uid:e}},[Zn,er,tr]),ir=de("get",function(e){return{query:e}},[zn,Jn,Yn],!1),ur="",cr=function(e){var t=void 0,n=void 0;n=function(e){var n=e.authEndpoint,r=e.project;return!(!n||!r)&&(Un(n+"/projects/"+r+"/sessions",{method:"POST"}),t&&t.unobserve(),!0)},n(e.getState("config"))||(t=e.observeState("config",n))},ar="simpla-token",sr="https://simpla.auth0.com/",fr="Could not remember login token. Are you in Private Mode?",lr="Could not load login token from storage. Are you in Private Mode?",dr="Could not logout. Are you in Private Mode?",pr="Invalid token",vr=function(e){Ce(e),e.observeState("token",Ne)},hr=Re();hr.withExtraArgument=Re;var yr,mr=function(e){return function(t){return e.indexOf(t)===-1}},gr=function(e){return function(t){return e!==t}},br=!1,wr=A({hierarchy:Xe,content:ze}),_r={verbose:{},simple:{}},jr=A((yr={},kt(yr,Fn,wr),kt(yr,Bn,Le),kt(yr,"authenticated",Me),kt(yr,"config",Ue),kt(yr,"editable",Fe),kt(yr,"token",Je),kt(yr,"buffer",We),yr));qe();var Or=new(function(){function e(){Et(this,e);var t=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||k;this._store=S(jr,t(P(hr)))}return At(e,[{key:"init",value:function(e){this._store.dispatch(x("project",e)),this._store.dispatch(x("authEndpoint",ur)),this._store.dispatch(x("dataEndpoint",ur+"/projects/"+e+"/content"))}},{key:"login",value:function(){return Q(this._store,L.apply(void 0,arguments),on)}},{key:"logout",value:function(){return Q(this._store,H.apply(void 0,arguments),an)}},{key:"find",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.parent,r=t.ancestor;return n&&(t.parent=oe(n)),r&&(t.ancestor=oe(r)),Promise.resolve().then(function(){n&&ae(n),r&&ae(r)}).then(function(){return Q(e._store,Te(t),pn)}).then(ce).then(V)}},{key:"get",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=oe(e);return Promise.resolve().then(function(){return ae(e)}).then(function(){return Q(t._store,Se.apply(void 0,[i].concat(r)),hn)}).then(ue).then(V)}},{key:"set",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=oe(e);return Promise.resolve().then(function(){return ae(e)}).then(function(){return Q(t._store,je.apply(void 0,[i].concat(r)),mn)}).then(ue)}},{key:"remove",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=oe(e);return Promise.resolve().then(function(){return ae(e)}).then(function(){return Q(t._store,Oe.apply(void 0,[i].concat(r)),wn)}).then(ue)}},{key:"observe",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=r.pop(),u=oe(e),c=void 0,a=void 0;if(!u)throw new Error("Observe must be given a valid path");return ae(e),c=[Fn,"content",u],a=function(){return t.get(e).then(i)},G(this._store).observe(c,a)}},{key:"observeQuery",value:function(e,t){var n=this,r=void 0,o=void 0,i=void 0,u=void 0;return e=Pt({},e),e.parent&&(e.parent=oe(e.parent)),e.ancestor&&(e.ancestor=oe(e.ancestor)),o=ee(e),i=[Bn,o,"matches"],r=this._store.getState()[Fn].content,this._store.dispatch(Ee({query:e,content:r})),u=function(e){return t(ce(V(J(e,n._store.getState()))))},G(this._store).observe(i,u)}},{key:"prefetch",value:function(e){return this.find({ancestor:e}).then(function(){})}},{key:"save",value:function(){return Q(this._store,xe.apply(void 0,arguments),fn)}},{key:"editable",value:function(e){this._store.dispatch(e?q():I())}},{key:"getState",value:function(e){var t=this._store.getState();if(e){var n=Hn[e];return n?X(n,t):void 0}return Object.keys(Hn).reduce(function(e,n){var r=Hn[n];return Pt(e,kt({},n,X(r,t)))},{})}},{key:"observeState",value:function(e,t){if(!e)throw new Error("No state given. Must include a state to observe e.g. Simpla.observeState('authenticated', showAdmin)");var n=Hn[e];return G(this._store).observe(n,t)}}]),e}()),Sr=[cr,vr];return Sr.forEach(function(e){return e(Or)}),Or});